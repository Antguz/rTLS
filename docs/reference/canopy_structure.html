<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Canopy Structure — canopy_structure • rTLS</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Canopy Structure — canopy_structure" />

<meta property="og:description" content="Estimates the canopy structure from a discrete returns scan from different TLS." />





<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rTLS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Artificial-stands.html">Creation of artificial stands</a>
    </li>
    <li>
      <a href="../articles/tree-metrics.html">Estimation of tree metrics</a>
    </li>
    <li>
      <a href="../articles/voxels-fractals.html">Voxel counting and fractal geometry</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Antguz/rTLS/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Canopy Structure</h1>
    <small class="dont-index">Source: <a href='https://github.com/Antguz/rTLS/blob/master/R/canopy_structure.R'><code>R/canopy_structure.R</code></a></small>
    <div class="hidden name"><code>canopy_structure.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Estimates the canopy structure from a discrete returns scan from different TLS.</p>
    
    </div>

    <pre class="usage"><span class='fu'>canopy_structure</span>(
  <span class='no'>TLS.type</span>,
  <span class='no'>scan</span>,
  <span class='no'>zenith.range</span>,
  <span class='no'>zenith.rings</span>,
  <span class='no'>azimuth.range</span>,
  <span class='no'>vertical.resolution</span>,
  <span class='no'>TLS.pulse.counts</span>,
  <span class='kw'>TLS.resolution</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>TLS.coordinates</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>),
  <span class='kw'>TLS.frame</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>TLS.angles</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>threads</span> <span class='kw'>=</span> <span class='fl'>1</span>
)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>TLS.type</th>
      <td><p>A <code>character</code> describing is the TLS used. It most be one of <code>"single"</code> return, <code>"multiple"</code> return, or <code>"fixed.angle"</code> scanner.</p></td>
    </tr>
    <tr>
      <th>scan</th>
      <td><p>If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"fixed.angle"</code>, a <code>data.table</code> with three columns describing *XYZ* coordinates of the discrete return. If
<code>TLS.type</code> is equal to <code>"multiple"</code>, a <code>data.table</code> with four columns describing *XYZ* coordinates and the target count pulses. Currently, <code>"fixed.angle"</code> present errors, use with discretion.</p></td>
    </tr>
    <tr>
      <th>zenith.range</th>
      <td><p>If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, a <code>numeric</code> vector of length two describing the <code>min</code> and <code>max</code> range of the zenith angle to use.
Theoretically, the <code>max</code> range should be lower than 90 degrees.</p></td>
    </tr>
    <tr>
      <th>zenith.rings</th>
      <td><p>If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, a <code>numeric</code> vector of length one describing the number of zenith rings to use between <code>zenith.range</code>.
This is used to estimate the frequency of laser shots from the scanner and returns in <code>scan</code>. If <code>TLS.type = "fixed.angle"</code>, <code>zenith.rings = 1</code> be default.</p></td>
    </tr>
    <tr>
      <th>azimuth.range</th>
      <td><p>A <code>numeric</code> vector of length two describing the range of the azimuth angle to use. Theoretically, it should be between 0 and 360 degrees.</p></td>
    </tr>
    <tr>
      <th>vertical.resolution</th>
      <td><p>A <code>numeric</code> vector of length one describing the vertical resolution to extract the vertical profiles. Low values lead to more variable profiles.
The scale used needs to be in congruence with the scale of <code>scan</code>.</p></td>
    </tr>
    <tr>
      <th>TLS.pulse.counts</th>
      <td><p>If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, a <code>numeric</code> vector of length two describing the horizontal and vertical pulse counts of the scanner.
If <code>TLS.type</code> is equal to <code>"fixed.angle"</code>, a <code>numeric</code> vector of length one describing the horizontal pulse counts resolution.
Preferred parameter over <code>TLS.resolution</code> to estimate the number of pulses.</p></td>
    </tr>
    <tr>
      <th>TLS.resolution</th>
      <td><p>If <code>TLS.pulse.counts = NULL</code>, the code use the angles resolution to estimate the pulse counts in a given <code>TLS.frame</code>. If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, a <code>numeric</code> vector of length two describing the horizontal and vertical angle resolution of the scanner.
If <code>TLS.type</code> is equal to <code>"fixed.angle"</code>, a <code>numeric</code> vector of length one describing the horizontal angle resolution.</p></td>
    </tr>
    <tr>
      <th>TLS.coordinates</th>
      <td><p>A <code>numeric</code> vector of length three describing the scanner coordinates within <code>scan</code>.
It assumes that the coordinates are <code><a href='https://rdrr.io/r/base/c.html'>c(X = 0, Y = 0, Z = 0)</a></code> for default.</p></td>
    </tr>
    <tr>
      <th>TLS.frame</th>
      <td><p>If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, a <code>numeric</code> vector of length four describing the <code>min</code> and <code>max</code> of the zenith and azimuth angle of the scanner frame.
If <code>TLS.type = "fixed.angle"</code>, a <code>numeric</code> vector of length three describing the fixed zenith angle and the <code>min</code> and <code>max</code> of the azimuth angle of the scanner frame.
If <code>NULL</code>, it assumes that a complete hemisphere (<code><a href='https://rdrr.io/r/base/c.html'>c(zenith.min = 0, zenith.max = 90, azimuth.min = 0, azimuth.max = 360)</a></code>), or a cone projection (<code><a href='https://rdrr.io/r/base/c.html'>c(zenith = 57.5, azimuth.min = 0, azimuth.max = 360)</a></code>) depending on <code>TLS.type</code>.</p></td>
    </tr>
    <tr>
      <th>TLS.angles</th>
      <td><p>A <code>numeric</code> vector of length three describing the roll (*X*), pitch (*Y*), and yaw (*Z*) angles of the scanner during the scan.
If <code>NULL</code>, it assumes that there is no need to to correction of angles.
This needs to be used if <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, since it assumes that <code>"fixed.angle"</code> scanner is previously balanced. <code>NULL</code> as default.</p></td>
    </tr>
    <tr>
      <th>threads</th>
      <td><p>An <code>integer</code> specifying the number of threads to use. Experiment to see what works best for your data on your hardware.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>For any <code>TLS.type</code>, it returns a <code>data.table</code> with the height profiles defined by <code>vertical.resolution</code>, the gap probability based on the <code>zenith.range</code> and <code>zenith.rings</code>, and
the accumulative L(z) profiles based on the closest zenith ring to 57.5 degrees (hinge angle). If <code>TLS.type</code> is equal to <code>"fixed.angle"</code>, it returns f(z) or commonly named PAVD based on
on the ratio of the derivative of L(z) and the derivative of height (z). If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, it returns the normalized average weighting L/LAI, and PAVD: based
on the L (hinge angle) at the highest height and the ratio between the derivative of L/LAI average weighted and the derivative of z.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Since <code>scan</code> describes discrete returns measured by the TLS, <code>canopy_structre</code> first simulates the number of pulses emitted based on Danson et al. (2007). The simulated pulses are
created based on the TLS properties (<code>TLS.pulse.counts, TLS.resolution, TLS.frame</code>) assuming that the scanner is perfectly balance. Then these pulses are rotated (<code><a href='rotate3D.html'>rotate3D</a></code>) based on the <code>TLS.angles</code>
roll, pitch, and yaw, and move to <code>TLS.coordintates</code> to simulate the positioning of the scanner during the <code>scan</code>. Rotated simulated-pulses of interest and <code>scan</code> returns are then extracted based on the <code>zenith.range</code> and <code>azimuth.range</code> for a given number of <code>zenith.rings</code>, <code>azimuth.rings</code> and vertical profiles.
Using the frequency of pulses and returns the probability of gap (Pgap) is estimated. For <code>TLS.type = "multiple"</code>, the frequency of returns is estimated using the sum of 1/target count following Lovell et al. (2011).</p>
<p>Using the Pgap estimated per each zenith ring and vertical profile, <code>canopy_structure</code> then estimates the accumulative L(z) profiles based on the closest
zenith ring to 57.5 (hinge region) and, if <code>TLS.type = "fixed.angle"</code>, the f(z) or commonly named PAVD based on the ratio of the
derivative of L(z) and height (z) following Jupp et al. 2009 (Equation 18). If <code>TLS.type</code> is equal to <code>"single"</code> or <code>"multiple"</code>, <code>canopy_structure</code> also
estimates the normalized average weighted L/LAI, and then PAVD based on the L (hinge angle) at the highest height (LAI) and the ratio between the derivative
of L/LAI (average weighted) and the derivative of z (Jupp et al. 2009; Equation 21).</p>
<p>Jupp et al. 2009 excludes the zero zenith or fist ring to conduct the average weighted L/LAI estimations, <code>canopy_structre</code> does not excludes this sections since it depends on the regions of interest of the user.
Therefore, user should consider this difference since it may introduce more variability to profile estimations.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Danson F.M., Hetherington D., Morsdorf F., Koetz B., Allgower B. 2007. Forest canopy gap fraction from terrestrial laser scanning. IEEE Geosci. Remote Sensing Letters 4:157-160. doi: 10.1109/LGRS.2006.887064.</p>
<p>Lovell J.L., Jupp D.L.B., van Gorsel E., Jimenez-Berni J., Hopkinson C., Chasmer L. 2011. Foliage profiles from ground based waveform and discrete point LiDAR. In: SilviLaser 2011, Hobart, Australia, 16–20 October 2011.</p>
<p>Jupp D.L.B., Culvenor D.S., Lovell J.L., Newnham G.J., Strahler A.H., Woodcock C.E. 2009. Estimating forest LAI profiles and structural parameters using a ground-based laser called “Echidna®”. Tree Physiology 29(2): 171-181. doi: 10.1093/treephys/tpn022.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='co'>#Using a multiple return file</span>

<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>TLS_scan</span>)
<span class='no'>TLS_scan</span> <span class='kw'>&lt;-</span> <span class='no'>TLS_scan</span>[, <span class='fl'>1</span>:<span class='fl'>4</span>] <span class='co'>#Select the four columns required</span>

<span class='co'>#This will take a while#</span>
<span class='fu'>canopy_structure</span>(<span class='kw'>TLS.type</span> <span class='kw'>=</span> <span class='st'>"multiple"</span>, <span class='kw'>scan</span> <span class='kw'>=</span> <span class='no'>TLS_scan</span>, <span class='kw'>zenith.range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>50</span>,<span class='fl'>70</span>), <span class='kw'>zenith.rings</span> <span class='kw'>=</span> <span class='fl'>4</span>,
                 <span class='kw'>azimuth.range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>360</span>), <span class='kw'>vertical.resolution</span> <span class='kw'>=</span> <span class='fl'>0.25</span>,
                 <span class='kw'>TLS.resolution</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.04</span>, <span class='fl'>0.04</span>), <span class='kw'>TLS.frame</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>30</span>, <span class='fl'>130</span>, <span class='fl'>0</span>, <span class='fl'>360</span>),
                 <span class='kw'>TLS.angles</span> <span class='kw'>=</span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.293</span>, -<span class='fl'>0.835</span>, -<span class='fl'>150.159</span>))

<span class='co'>#Using a single return file</span>

<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>TLS_scan</span>)
<span class='no'>TLS_scan</span> <span class='kw'>&lt;-</span> <span class='no'>TLS_scan</span>[<span class='no'>Target_index</span> <span class='kw'>==</span> <span class='fl'>1</span>, <span class='fl'>1</span>:<span class='fl'>3</span>] <span class='co'>#Subset to first return observations</span>

<span class='co'>#This will take a while#</span>
<span class='fu'>canopy_structure</span>(<span class='kw'>TLS.type</span> <span class='kw'>=</span> <span class='st'>"single"</span>, <span class='kw'>scan</span> <span class='kw'>=</span> <span class='no'>TLS_scan</span>, <span class='kw'>zenith.range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>50</span>,<span class='fl'>70</span>), <span class='kw'>zenith.rings</span> <span class='kw'>=</span> <span class='fl'>4</span>,
                 <span class='kw'>azimuth.range</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fl'>360</span>), <span class='kw'>vertical.resolution</span> <span class='kw'>=</span> <span class='fl'>0.25</span>,
                 <span class='kw'>TLS.resolution</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.04</span>, <span class='fl'>0.04</span>), <span class='kw'>TLS.frame</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>30</span>, <span class='fl'>130</span>, <span class='fl'>0</span>, <span class='fl'>360</span>),
                 <span class='kw'>TLS.angles</span> <span class='kw'>=</span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0.293</span>, -<span class='fl'>0.835</span>, -<span class='fl'>150.159</span>))
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Antonio Guzmán, Ronny Hernandez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


